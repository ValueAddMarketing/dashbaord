<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAM Client Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: { 900: '#0a0a0f', 800: '#12121a', 700: '#1a1a24', 600: '#22222e', 500: '#2a2a38' },
                        accent: { cyan: '#00d4ff', purple: '#a855f7', green: '#10b981', yellow: '#fbbf24', red: '#ef4444' }
                    },
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #0a0a0f; color: #e5e5e5; }
        .gradient-text { background: linear-gradient(135deg, #00d4ff 0%, #a855f7 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .card { background: linear-gradient(145deg, #12121a 0%, #1a1a24 100%); border: 1px solid rgba(255,255,255,0.05); }
        .tab-active { background: linear-gradient(135deg, rgba(0,212,255,0.15) 0%, rgba(168,85,247,0.15) 100%); border-left: 3px solid #00d4ff; }
        .scrollbar::-webkit-scrollbar { width: 6px; }
        .scrollbar::-webkit-scrollbar-thumb { background: #2a2a38; border-radius: 3px; }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    </style>
</head>
<body class="min-h-screen">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const URLS = {
            clients: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRimOKUGksj-OVBSCpb9UGnkQU3Wu547GpcaUk4RT0oo5KM0fnVo2sk8mRpy4cwO5j9CckDORzmou-d/pub?gid=133498635&single=true&output=csv',
            setupTiming: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR4LTw-15NE0j25eIOpY_bTPSAipW7-F2eXnL0xtdXMWCZtK9z3MYWxHr6ltnMChLk-YDLzwiXAfvwE/pub?output=csv'
        };

        const pn = v => parseFloat(String(v||'0').replace(/[$,%]/g,'').replace(/,/g,''))||0;
        const fmt = v => '$'+(pn(v)).toLocaleString('en-US',{maximumFractionDigits:0});
        const fmtD = v => '$'+(pn(v)).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
        const fmtN = v => (pn(v)).toLocaleString('en-US',{maximumFractionDigits:0});
        const fmtP = v => (pn(v)).toFixed(1)+'%';

        // Map Media Buying sheet (ALL CLIENTS)
        const mapClient = r => ({
            client: r['Client']||'', adAccount: r['Ad Account Name']||'', state: r['State']||'', 
            campaign: r['CAMPAIGN']||'', callingStatus: r['Calling/Non-calling']||'', startDate: r['Start Date']||'',
            days: pn(r['Days Running']), weeks: pn(r['Weeks Running']), months: pn(r['Months Running']),
            spend: pn(r['Total Ad Spend']), sellerSpend: pn(r['Seller Ad Spend']), buyerSpend: pn(r['Buyer Ad Spend']),
            dailyBudget: pn(r['Daily Ad Spend Budget']), spendPerDay: pn(r['Ad Spend Per Day']),
            leads: pn(r['Total Leads']), cpl: pn(r['Cost Per Lead']),
            sellerLeads: pn(r['Seller Leads']), sellerCPL: pn(r['Cost Per Seller Lead']), sellerLeadsWeek: pn(r['Seller Leads/Week']),
            buyerLeads: pn(r['Buyer Leads']), listingLeads: pn(r['Listing Leads']),
            appts: pn(r['Total Appts']), apptsWeek: pn(r['Appt per Week']), appts7: pn(r['Appts in the Last 7 Days']),
            sellerAppts: pn(r['Seller Appts']), sellerLeadToAppt: pn(r['Seller Lead > Appt']), sellerApptCost: pn(r['Cost per Seller Appts']),
            buyerAppts: pn(r['Buyer Appts']), buyerApptCost: pn(r['Cost per Buyer Appt']),
            deals: pn(r['Potential Deals']), listings: pn(r['Listing']), buyerSigned: pn(r['Buyer Signed']), leadsPerListing: pn(r['Leads/Listing'])
        });

        // Map Setup Timing sheet - need to handle various column name possibilities
        const mapSetupTiming = r => {
            // Get the first column which should be client name (might be "VAM", "Active Clients: 62", or actual name)
            const keys = Object.keys(r);
            const clientName = r[keys[0]] || '';
            
            return {
                client: clientName,
                csmRep: r['CSM'] || r['Rep'] || r[keys[1]] || '',
                status: r['Status'] || r['Lender'] || r[keys[2]] || '',
                paidDate: r['Paid date'] || r[keys.find(k => k.toLowerCase().includes('paid'))] || '',
                onboardedDate: r['Onboarded date'] || r[keys.find(k => k.toLowerCase().includes('onboard'))] || '',
                launchCallDate: r['Launch call date'] || r[keys.find(k => k.toLowerCase().includes('launch'))] || '',
                adLiveDate: r['Ad Live date'] || r['Ad Live'] || r[keys.find(k => k.toLowerCase().includes('ad live'))] || ''
            };
        };

        const getHealth = cpl => { if(!cpl) return 'Gray'; if(cpl<=25) return 'Green'; if(cpl<=50) return 'Yellow'; return 'Red'; };
        const getPhase = days => {
            if(days<=14) return {n:1,name:'Setup',color:'cyan'};
            if(days<=30) return {n:2,name:'Optimization',color:'purple'};
            if(days<=60) return {n:3,name:'Scaling',color:'green'};
            return {n:4,name:'Systemization',color:'yellow'};
        };

        const healthColors = { Green:'bg-emerald-500', Yellow:'bg-amber-500', Red:'bg-red-500', Gray:'bg-gray-500' };
        const healthText = { Green:'text-emerald-400', Yellow:'text-amber-400', Red:'text-red-400', Gray:'text-gray-400' };
        const phaseColors = { cyan:'bg-cyan-500/20 text-cyan-400', purple:'bg-purple-500/20 text-purple-400', green:'bg-emerald-500/20 text-emerald-400', yellow:'bg-amber-500/20 text-amber-400' };

        const Badge = ({health}) => <span className={`px-2 py-0.5 rounded-full text-xs font-semibold ${healthColors[health]}/20 ${healthText[health]} border border-current/30`}>{health}</span>;
        const PhaseBadge = ({days}) => { const p=getPhase(days); return <span className={`px-2 py-0.5 rounded-full text-xs font-semibold ${phaseColors[p.color]}`}>Phase {p.n}: {p.name}</span>; };

        const tabs = [
            { id: 'overview', name: 'Overview', icon: 'üìä' },
            { id: 'info', name: 'Client Information', icon: 'üë§' },
            { id: 'performance', name: 'Performance', icon: 'üìà' },
            { id: 'strategy', name: 'Strategy & Notes', icon: 'üìù' },
        ];

        const phaseChecks = {
            1: ['CRM Access Setup', 'Ad Account Connected', 'Strategy Call Completed', 'First Ads Live', 'Tracking Verified'],
            2: ['Lead Flow Optimized', 'CPL Under Target', 'Follow-up Sequences Active', 'Weekly Check-in Done'],
            3: ['Budget Scaling Started', 'Retargeting Active', 'Conversion Tracking', 'ROI Positive'],
            4: ['SOPs Documented', 'Team Trained', 'Automation Complete', 'Handoff Ready']
        };

        // ========== OVERVIEW TAB ==========
        const OverviewTab = ({c, setupInfo}) => {
            const [checks, setChecks] = useState({});
            if(!c) return <div className="card rounded-xl p-12 text-center text-gray-500">Select a client to view details</div>;
            const phase = getPhase(c.days);
            return (
                <div className="space-y-6">
                    <div className="flex items-center gap-4 flex-wrap">
                        <Badge health={getHealth(c.cpl)}/>
                        <PhaseBadge days={c.days}/>
                        <span className="text-gray-500">{c.campaign} ‚Ä¢ {c.callingStatus}</span>
                        {setupInfo?.csmRep && <span className="px-2 py-0.5 bg-accent-purple/20 text-accent-purple rounded-full text-xs">CSM: {setupInfo.csmRep}</span>}
                    </div>
                    <div className="card rounded-xl p-6">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-lg font-semibold text-white">90-Day Progress</h3>
                            <span className="text-gray-400">Day {c.days} of 90</span>
                        </div>
                        <div className="w-full bg-dark-700 rounded-full h-3 mb-2">
                            <div className="bg-gradient-to-r from-accent-cyan to-accent-purple h-3 rounded-full" style={{width:`${Math.min(c.days/90*100,100)}%`}}/>
                        </div>
                        <div className="flex justify-between text-xs text-gray-500 mt-2">
                            <span>Phase 1</span><span>Phase 2</span><span>Phase 3</span><span>Phase 4</span>
                        </div>
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div className="card rounded-xl p-5 text-center"><div className="text-2xl font-bold text-white">{fmt(c.spend)}</div><div className="text-sm text-gray-500">Total Spend</div></div>
                        <div className="card rounded-xl p-5 text-center"><div className="text-2xl font-bold text-accent-cyan">{fmtN(c.leads)}</div><div className="text-sm text-gray-500">Total Leads</div></div>
                        <div className="card rounded-xl p-5 text-center"><div className="text-2xl font-bold text-white">{fmtD(c.cpl)}</div><div className="text-sm text-gray-500">Cost Per Lead</div></div>
                        <div className="card rounded-xl p-5 text-center"><div className="text-2xl font-bold text-accent-purple">{fmtN(c.appts)}</div><div className="text-sm text-gray-500">Appointments</div></div>
                    </div>
                    <div className="card rounded-xl p-6">
                        <h3 className="text-lg font-semibold text-white mb-4">Phase {phase.n} Checklist: {phase.name}</h3>
                        <div className="space-y-2">
                            {phaseChecks[phase.n].map((item,i) => (
                                <label key={i} className="flex items-center gap-3 p-3 bg-dark-800 rounded-lg cursor-pointer hover:bg-dark-700">
                                    <input type="checkbox" checked={checks[`${phase.n}-${i}`]||false} onChange={()=>setChecks(p=>({...p,[`${phase.n}-${i}`]:!p[`${phase.n}-${i}`]}))} className="w-5 h-5 rounded border-gray-600 text-accent-cyan"/>
                                    <span className={checks[`${phase.n}-${i}`]?'text-gray-500 line-through':'text-gray-300'}>{item}</span>
                                </label>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // ========== CLIENT INFORMATION TAB ==========
        const ClientInfoTab = ({c, setupInfo}) => {
            if(!c) return <div className="card rounded-xl p-12 text-center text-gray-500">Select a client to view details</div>;
            
            const formatDate = (d) => {
                if(!d) return '‚Äî';
                return d;
            };

            const getDaysSince = (dateStr) => {
                if(!dateStr) return null;
                try {
                    const date = new Date(dateStr);
                    const today = new Date();
                    const diff = Math.floor((today - date) / (1000 * 60 * 60 * 24));
                    return diff >= 0 ? diff : null;
                } catch { return null; }
            };

            return (
                <div className="space-y-6">
                    <h2 className="text-xl font-bold gradient-text">Client Information</h2>
                    
                    {/* Basic Info */}
                    <div className="card rounded-xl p-6">
                        <h3 className="text-lg font-semibold text-white mb-4">üë§ Basic Details</h3>
                        <div className="grid md:grid-cols-2 gap-6">
                            <div className="space-y-4">
                                <div className="flex justify-between p-3 bg-dark-800 rounded-lg">
                                    <span className="text-gray-400">Client Name</span>
                                    <span className="text-white font-semibold">{c.client}</span>
                                </div>
                                <div className="flex justify-between p-3 bg-dark-800 rounded-lg">
                                    <span className="text-gray-400">State</span>
                                    <span className="text-white">{c.state || '‚Äî'}</span>
                                </div>
                                <div className="flex justify-between p-3 bg-dark-800 rounded-lg">
                                    <span className="text-gray-400">Ad Account</span>
                                    <span className="text-white">{c.adAccount || '‚Äî'}</span>
                                </div>
                                <div className="flex justify-between p-3 bg-dark-800 rounded-lg">
                                    <span className="text-gray-400">Campaign Type</span>
                                    <span className="text-white">{c.campaign || '‚Äî'}</span>
                                </div>
                            </div>
                            <div className="space-y-4">
                                <div className="flex justify-between p-3 bg-dark-800 rounded-lg">
                                    <span className="text-gray-400">Calling Status</span>
                                    <span className={`font-semibold ${c.callingStatus?.toLowerCase().includes('calling') ? 'text-accent-green' : 'text-gray-400'}`}>{c.callingStatus || '‚Äî'}</span>
                                </div>
                                <div className="flex justify-between p-3 bg-dark-800 rounded-lg">
                                    <span className="text-gray-400">CSM Rep</span>
                                    <span className="text-accent-purple font-semibold">{setupInfo?.csmRep || '‚Äî'}</span>
                                </div>
                                <div className="flex justify-between p-3 bg-dark-800 rounded-lg">
                                    <span className="text-gray-400">Lender Status</span>
                                    <span className={`font-semibold ${setupInfo?.status?.toLowerCase() === 'none' ? 'text-gray-400' : 'text-accent-green'}`}>{setupInfo?.status || '‚Äî'}</span>
                                </div>
                                <div className="flex justify-between p-3 bg-dark-800 rounded-lg">
                                    <span className="text-gray-400">Days Running</span>
                                    <span className="text-accent-cyan font-semibold">{c.days} days</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Timeline */}
                    <div className="card rounded-xl p-6">
                        <h3 className="text-lg font-semibold text-white mb-4">üìÖ Key Dates & Timeline</h3>
                        <div className="grid md:grid-cols-4 gap-4">
                            <div className="bg-dark-800 rounded-xl p-4 text-center">
                                <div className="text-3xl mb-2">üí∞</div>
                                <div className="text-lg font-bold text-white">{formatDate(setupInfo?.paidDate)}</div>
                                <div className="text-sm text-gray-500">Paid Date</div>
                                {getDaysSince(setupInfo?.paidDate) !== null && (
                                    <div className="text-xs text-accent-cyan mt-1">{getDaysSince(setupInfo?.paidDate)} days ago</div>
                                )}
                            </div>
                            <div className="bg-dark-800 rounded-xl p-4 text-center">
                                <div className="text-3xl mb-2">üöÄ</div>
                                <div className="text-lg font-bold text-white">{formatDate(setupInfo?.onboardedDate)}</div>
                                <div className="text-sm text-gray-500">Onboarded</div>
                                {getDaysSince(setupInfo?.onboardedDate) !== null && (
                                    <div className="text-xs text-accent-purple mt-1">{getDaysSince(setupInfo?.onboardedDate)} days ago</div>
                                )}
                            </div>
                            <div className="bg-dark-800 rounded-xl p-4 text-center">
                                <div className="text-3xl mb-2">üìû</div>
                                <div className="text-lg font-bold text-white">{formatDate(setupInfo?.launchCallDate)}</div>
                                <div className="text-sm text-gray-500">Launch Call</div>
                                {getDaysSince(setupInfo?.launchCallDate) !== null && (
                                    <div className="text-xs text-accent-green mt-1">{getDaysSince(setupInfo?.launchCallDate)} days ago</div>
                                )}
                            </div>
                            <div className="bg-dark-800 rounded-xl p-4 text-center">
                                <div className="text-3xl mb-2">üì¢</div>
                                <div className="text-lg font-bold text-white">{formatDate(setupInfo?.adLiveDate)}</div>
                                <div className="text-sm text-gray-500">Ads Live</div>
                                {getDaysSince(setupInfo?.adLiveDate) !== null && (
                                    <div className="text-xs text-accent-yellow mt-1">{getDaysSince(setupInfo?.adLiveDate)} days ago</div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Progress Timeline Visual */}
                    <div className="card rounded-xl p-6">
                        <h3 className="text-lg font-semibold text-white mb-4">‚è±Ô∏è Onboarding Progress</h3>
                        <div className="flex items-center justify-between">
                            <div className="flex flex-col items-center">
                                <div className={`w-10 h-10 rounded-full flex items-center justify-center ${setupInfo?.paidDate ? 'bg-accent-green' : 'bg-dark-600'}`}>
                                    {setupInfo?.paidDate ? '‚úì' : '1'}
                                </div>
                                <span className="text-xs text-gray-500 mt-2">Paid</span>
                            </div>
                            <div className={`flex-1 h-1 mx-2 ${setupInfo?.onboardedDate ? 'bg-accent-green' : 'bg-dark-600'}`}/>
                            <div className="flex flex-col items-center">
                                <div className={`w-10 h-10 rounded-full flex items-center justify-center ${setupInfo?.onboardedDate ? 'bg-accent-green' : 'bg-dark-600'}`}>
                                    {setupInfo?.onboardedDate ? '‚úì' : '2'}
                                </div>
                                <span className="text-xs text-gray-500 mt-2">Onboarded</span>
                            </div>
                            <div className={`flex-1 h-1 mx-2 ${setupInfo?.launchCallDate ? 'bg-accent-green' : 'bg-dark-600'}`}/>
                            <div className="flex flex-col items-center">
                                <div className={`w-10 h-10 rounded-full flex items-center justify-center ${setupInfo?.launchCallDate ? 'bg-accent-green' : 'bg-dark-600'}`}>
                                    {setupInfo?.launchCallDate ? '‚úì' : '3'}
                                </div>
                                <span className="text-xs text-gray-500 mt-2">Launch Call</span>
                            </div>
                            <div className={`flex-1 h-1 mx-2 ${setupInfo?.adLiveDate ? 'bg-accent-green' : 'bg-dark-600'}`}/>
                            <div className="flex flex-col items-center">
                                <div className={`w-10 h-10 rounded-full flex items-center justify-center ${setupInfo?.adLiveDate ? 'bg-accent-green' : 'bg-dark-600'}`}>
                                    {setupInfo?.adLiveDate ? '‚úì' : '4'}
                                </div>
                                <span className="text-xs text-gray-500 mt-2">Ads Live</span>
                            </div>
                        </div>
                    </div>

                    {/* Quick Stats from Media Buying */}
                    <div className="card rounded-xl p-6">
                        <h3 className="text-lg font-semibold text-white mb-4">üìä Current Performance Snapshot</h3>
                        <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                            <div className="text-center p-3 bg-dark-800 rounded-lg">
                                <div className="text-xl font-bold text-white">{fmt(c.spend)}</div>
                                <div className="text-xs text-gray-500">Total Spend</div>
                            </div>
                            <div className="text-center p-3 bg-dark-800 rounded-lg">
                                <div className="text-xl font-bold text-accent-cyan">{fmtN(c.leads)}</div>
                                <div className="text-xs text-gray-500">Leads</div>
                            </div>
                            <div className="text-center p-3 bg-dark-800 rounded-lg">
                                <div className="text-xl font-bold text-white">{fmtD(c.cpl)}</div>
                                <div className="text-xs text-gray-500">CPL</div>
                            </div>
                            <div className="text-center p-3 bg-dark-800 rounded-lg">
                                <div className="text-xl font-bold text-accent-purple">{fmtN(c.appts)}</div>
                                <div className="text-xs text-gray-500">Appts</div>
                            </div>
                            <div className="text-center p-3 bg-dark-800 rounded-lg">
                                <div className="text-xl font-bold text-accent-green">{fmtN(c.deals)}</div>
                                <div className="text-xs text-gray-500">Deals</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ========== PERFORMANCE TAB (Combined) ==========
        const PerformanceTab = ({c}) => {
            if(!c) return <div className="card rounded-xl p-12 text-center text-gray-500">Select a client to view details</div>;
            return (
                <div className="space-y-6">
                    {/* Spend Overview */}
                    <div>
                        <h2 className="text-xl font-bold text-white mb-4">üí∞ Spend Overview</h2>
                        <div className="grid md:grid-cols-4 gap-4">
                            <div className="card rounded-xl p-5 text-center"><div className="text-2xl font-bold text-white">{fmt(c.spend)}</div><div className="text-sm text-gray-500">Total Spend</div></div>
                            <div className="card rounded-xl p-5 text-center"><div className="text-2xl font-bold text-white">{fmtD(c.dailyBudget)}</div><div className="text-sm text-gray-500">Daily Budget</div></div>
                            <div className="card rounded-xl p-5 text-center"><div className="text-2xl font-bold text-accent-cyan">{fmtD(c.spendPerDay)}</div><div className="text-sm text-gray-500">Actual/Day</div></div>
                            <div className="card rounded-xl p-5 text-center"><div className="text-2xl font-bold text-accent-purple">{c.weeks}</div><div className="text-sm text-gray-500">Weeks Running</div></div>
                        </div>
                        <div className="card rounded-xl p-5 mt-4">
                            <div className="grid grid-cols-3 gap-4 text-center">
                                <div><div className="text-lg font-bold text-white">{fmt(c.sellerSpend)}</div><div className="text-xs text-gray-500">Seller Spend</div></div>
                                <div><div className="text-lg font-bold text-white">{fmt(c.buyerSpend)}</div><div className="text-xs text-gray-500">Buyer Spend</div></div>
                                <div><div className="text-lg font-bold text-accent-cyan">{fmt(c.spend)}</div><div className="text-xs text-gray-500">Total</div></div>
                            </div>
                        </div>
                    </div>

                    {/* Leads */}
                    <div>
                        <h2 className="text-xl font-bold text-white mb-4">üéØ Lead Generation</h2>
                        <div className="grid md:grid-cols-4 gap-4">
                            <div className="card rounded-xl p-5 text-center"><div className="text-2xl font-bold text-accent-cyan">{fmtN(c.leads)}</div><div className="text-sm text-gray-500">Total Leads</div></div>
                            <div className="card rounded-xl p-5 text-center"><div className="text-2xl font-bold text-white">{fmtN(c.sellerLeads)}</div><div className="text-sm text-gray-500">Seller Leads</div></div>
                            <div className="card rounded-xl p-5 text-center"><div className="text-2xl font-bold text-white">{fmtN(c.buyerLeads)}</div><div className="text-sm text-gray-500">Buyer Leads</div></div>
                            <div className="card rounded-xl p-5 text-center"><div className="text-2xl font-bold text-accent-purple">{fmtN(c.listingLeads)}</div><div className="text-sm text-gray-500">Listing Leads</div></div>
                        </div>
                        <div className="card rounded-xl p-5 mt-4">
                            <h4 className="font-semibold text-white mb-3">Cost Efficiency</h4>
                            <div className="grid md:grid-cols-3 gap-4">
                                <div className="flex justify-between"><span className="text-gray-400">Overall CPL</span><span className="font-mono text-white">{fmtD(c.cpl)}</span></div>
                                <div className="flex justify-between"><span className="text-gray-400">Seller CPL</span><span className="font-mono text-white">{fmtD(c.sellerCPL)}</span></div>
                                <div className="flex justify-between"><span className="text-gray-400">Seller Leads/Week</span><span className="font-mono text-accent-cyan">{c.sellerLeadsWeek.toFixed(1)}</span></div>
                            </div>
                        </div>
                    </div>

                    {/* Appointments */}
                    <div>
                        <h2 className="text-xl font-bold text-white mb-4">üìÖ Appointments</h2>
                        <div className="grid md:grid-cols-4 gap-4">
                            <div className="card rounded-xl p-5 text-center"><div className="text-2xl font-bold text-accent-purple">{fmtN(c.appts)}</div><div className="text-sm text-gray-500">Total Appts</div></div>
                            <div className="card rounded-xl p-5 text-center"><div className="text-2xl font-bold text-accent-cyan">{fmtN(c.appts7)}</div><div className="text-sm text-gray-500">Last 7 Days</div></div>
                            <div className="card rounded-xl p-5 text-center"><div className="text-2xl font-bold text-white">{c.apptsWeek.toFixed(1)}</div><div className="text-sm text-gray-500">Appts/Week</div></div>
                            <div className="card rounded-xl p-5 text-center"><div className="text-2xl font-bold text-accent-green">{fmtP(c.sellerLeadToAppt)}</div><div className="text-sm text-gray-500">Lead‚ÜíAppt Rate</div></div>
                        </div>
                        <div className="card rounded-xl p-5 mt-4">
                            <div className="grid md:grid-cols-4 gap-4">
                                <div className="flex justify-between"><span className="text-gray-400">Seller Appts</span><span className="font-mono text-white">{fmtN(c.sellerAppts)}</span></div>
                                <div className="flex justify-between"><span className="text-gray-400">Cost/Seller Appt</span><span className="font-mono text-white">{fmtD(c.sellerApptCost)}</span></div>
                                <div className="flex justify-between"><span className="text-gray-400">Buyer Appts</span><span className="font-mono text-white">{fmtN(c.buyerAppts)}</span></div>
                                <div className="flex justify-between"><span className="text-gray-400">Cost/Buyer Appt</span><span className="font-mono text-white">{fmtD(c.buyerApptCost)}</span></div>
                            </div>
                        </div>
                    </div>

                    {/* Deals */}
                    <div>
                        <h2 className="text-xl font-bold text-white mb-4">üè† Deals & Closings</h2>
                        <div className="grid md:grid-cols-3 gap-4">
                            <div className="card rounded-xl p-6 text-center"><div className="text-3xl font-bold text-accent-green">{fmtN(c.deals)}</div><div className="text-sm text-gray-500 mt-1">Potential Deals</div></div>
                            <div className="card rounded-xl p-6 text-center"><div className="text-3xl font-bold text-accent-yellow">{fmtN(c.listings)}</div><div className="text-sm text-gray-500 mt-1">Listings</div></div>
                            <div className="card rounded-xl p-6 text-center"><div className="text-3xl font-bold text-accent-purple">{fmtN(c.buyerSigned)}</div><div className="text-sm text-gray-500 mt-1">Buyer Signed</div></div>
                        </div>
                        <div className="card rounded-xl p-5 mt-4">
                            <h4 className="font-semibold text-white mb-3">ROI Metrics</h4>
                            <div className="grid md:grid-cols-3 gap-4">
                                <div className="flex justify-between"><span className="text-gray-400">Leads/Listing</span><span className="font-mono text-white">{c.leadsPerListing.toFixed(0)}</span></div>
                                <div className="flex justify-between"><span className="text-gray-400">Total Closed</span><span className="font-mono text-accent-green">{fmtN(c.listings + c.buyerSigned)}</span></div>
                                <div className="flex justify-between"><span className="text-gray-400">Cost/Closed Deal</span><span className="font-mono text-white">{(c.listings+c.buyerSigned)>0?fmtD(c.spend/(c.listings+c.buyerSigned)):'N/A'}</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ========== STRATEGY & NOTES TAB ==========
        const StrategyTab = ({c}) => {
            const [notes, setNotes] = useState([]);
            const [newNote, setNewNote] = useState('');
            const [strategy, setStrategy] = useState('');
            const [actions, setActions] = useState('');

            const addNote = () => {
                if(newNote.trim()) {
                    setNotes([{time: new Date().toLocaleString(), text: newNote, client: c?.client||'General'}, ...notes]);
                    setNewNote('');
                }
            };

            return (
                <div className="space-y-6">
                    <div>
                        <h2 className="text-xl font-bold text-white mb-4">üß† Strategy</h2>
                        <div className="card rounded-xl p-6">
                            <h4 className="font-semibold text-white mb-3">Current Strategy</h4>
                            <textarea value={strategy} onChange={e=>setStrategy(e.target.value)} className="w-full bg-dark-800 border border-dark-500 rounded-lg p-4 text-white min-h-[120px] focus:outline-none focus:border-accent-cyan" placeholder="Document the current strategy..."/>
                        </div>
                        <div className="card rounded-xl p-6 mt-4">
                            <h4 className="font-semibold text-white mb-3">Action Items</h4>
                            <textarea value={actions} onChange={e=>setActions(e.target.value)} className="w-full bg-dark-800 border border-dark-500 rounded-lg p-4 text-white min-h-[120px] focus:outline-none focus:border-accent-cyan" placeholder="List action items..."/>
                        </div>
                    </div>
                    <div>
                        <h2 className="text-xl font-bold text-white mb-4">üìù Notes Log</h2>
                        <div className="card rounded-xl p-6">
                            <div className="flex gap-4">
                                <input type="text" value={newNote} onChange={e=>setNewNote(e.target.value)} onKeyPress={e=>e.key==='Enter'&&addNote()} className="flex-1 bg-dark-800 border border-dark-500 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-accent-cyan" placeholder="Add a note..."/>
                                <button onClick={addNote} className="px-6 py-3 bg-accent-cyan text-dark-900 font-semibold rounded-lg hover:bg-cyan-400">Add</button>
                            </div>
                        </div>
                        <div className="space-y-3 mt-4">
                            {notes.length===0 && <div className="card rounded-xl p-8 text-center text-gray-500">No notes yet.</div>}
                            {notes.map((n,i) => (
                                <div key={i} className="card rounded-xl p-4">
                                    <div className="flex gap-4 text-sm mb-2"><span className="font-mono text-gray-500">{n.time}</span><span className="text-accent-purple">{n.client}</span></div>
                                    <div className="text-gray-300">{n.text}</div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // ========== AI CHAT ==========
        const AIChat = ({open, onClose, client, setupInfo}) => {
            const [msgs, setMsgs] = useState([]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);

            const send = () => {
                if(!input.trim()) return;
                setMsgs(p=>[...p, {role:'user', content:input}]);
                setLoading(true);
                const q = input.toLowerCase();
                setInput('');

                setTimeout(() => {
                    let res = '';
                    if(client) {
                        const c = client;
                        if(q.includes('summary')||q.includes('overview')) {
                            res = `üìä ${c.client} Summary:\n‚Ä¢ Day ${c.days} (Phase ${getPhase(c.days).n})\n‚Ä¢ CSM: ${setupInfo?.csmRep || 'N/A'}\n‚Ä¢ Spend: ${fmt(c.spend)}\n‚Ä¢ Leads: ${fmtN(c.leads)} (${fmtD(c.cpl)} CPL)\n‚Ä¢ Appts: ${fmtN(c.appts)}\n‚Ä¢ Deals: ${fmtN(c.deals)}`;
                        } else if(q.includes('timeline')||q.includes('dates')||q.includes('onboard')) {
                            res = `üìÖ ${c.client} Timeline:\n‚Ä¢ Paid: ${setupInfo?.paidDate || 'N/A'}\n‚Ä¢ Onboarded: ${setupInfo?.onboardedDate || 'N/A'}\n‚Ä¢ Launch Call: ${setupInfo?.launchCallDate || 'N/A'}\n‚Ä¢ Ads Live: ${setupInfo?.adLiveDate || 'N/A'}`;
                        } else if(q.includes('improve')||q.includes('optimize')) {
                            const h = getHealth(c.cpl);
                            res = h==='Red' ? `‚ö†Ô∏è CPL is high at ${fmtD(c.cpl)}:\n‚Ä¢ Review targeting\n‚Ä¢ Test new creatives\n‚Ä¢ Check landing page` : h==='Yellow' ? `üìà CPL at ${fmtD(c.cpl)} - can improve:\n‚Ä¢ A/B test headlines\n‚Ä¢ Refine audience` : `‚úÖ Great CPL at ${fmtD(c.cpl)}!\n‚Ä¢ Consider scaling\n‚Ä¢ Document what works`;
                        } else {
                            res = `Ask about ${c.client}:\n‚Ä¢ "Summary"\n‚Ä¢ "Timeline/dates"\n‚Ä¢ "How to improve?"`;
                        }
                    } else {
                        res = 'Select a client first!';
                    }
                    setMsgs(p=>[...p, {role:'assistant', content:res}]);
                    setLoading(false);
                }, 500);
            };

            if(!open) return null;
            return (
                <div className="fixed inset-y-0 right-0 w-96 bg-dark-800 border-l border-dark-600 z-50 flex flex-col slide-in">
                    <div className="p-4 border-b border-dark-600 flex justify-between">
                        <div><h3 className="font-bold text-white">AI Assistant</h3><p className="text-xs text-gray-500">{client?.client||'No client'}</p></div>
                        <button onClick={onClose} className="text-gray-400 hover:text-white text-2xl">&times;</button>
                    </div>
                    <div className="flex-1 overflow-y-auto p-4 space-y-4 scrollbar">
                        {msgs.length===0 && (
                            <div className="text-center py-8 text-gray-500">
                                <div className="text-4xl mb-3">ü§ñ</div>
                                {['Summary','Timeline/dates','How to improve?'].map((s,i)=>(
                                    <button key={i} onClick={()=>setInput(s)} className="block w-full text-left px-3 py-2 mb-2 bg-dark-700 rounded-lg text-sm text-gray-400 hover:text-white hover:bg-dark-600">{s}</button>
                                ))}
                            </div>
                        )}
                        {msgs.map((m,i)=><div key={i} className={m.role==='user'?'ml-8':'mr-8'}><div className={`p-3 rounded-xl whitespace-pre-wrap ${m.role==='user'?'bg-accent-cyan/20 text-cyan-100':'bg-dark-700 text-gray-300'}`}>{m.content}</div></div>)}
                        {loading && <div className="mr-8"><div className="bg-dark-700 text-gray-500 p-3 rounded-xl">Thinking...</div></div>}
                    </div>
                    <div className="p-4 border-t border-dark-600 flex gap-2">
                        <input type="text" value={input} onChange={e=>setInput(e.target.value)} onKeyPress={e=>e.key==='Enter'&&send()} className="flex-1 bg-dark-700 border border-dark-500 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-accent-cyan" placeholder="Ask..."/>
                        <button onClick={send} className="px-4 py-2 bg-accent-cyan text-dark-900 rounded-lg font-semibold">Send</button>
                    </div>
                </div>
            );
        };

        // ========== MAIN APP ==========
        const App = () => {
            const [clients, setClients] = useState([]);
            const [setupData, setSetupData] = useState([]);
            const [selected, setSelected] = useState(null);
            const [tab, setTab] = useState('overview');
            const [aiOpen, setAiOpen] = useState(false);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                Promise.all([
                    // Fetch Media Buying data (skip 2 header rows)
                    fetch(URLS.clients)
                        .then(r=>r.text())
                        .then(csv=>{
                            const lines = csv.split('\n');
                            return Papa.parse(lines.slice(2).join('\n'), {header:true, skipEmptyLines:true}).data.map(mapClient).filter(r=>r.client);
                        })
                        .catch(()=>[]),
                    
                    // Fetch Setup Timing data (skip 2 header rows based on screenshot)
                    fetch(URLS.setupTiming)
                        .then(r=>r.text())
                        .then(csv=>{
                            const lines = csv.split('\n');
                            // Skip header rows (VAM, Active Clients row)
                            const dataLines = lines.slice(2).join('\n');
                            return Papa.parse(dataLines, {header:true, skipEmptyLines:true}).data.map(mapSetupTiming).filter(r=>r.client && !r.client.includes('VAM') && !r.client.includes('Active'));
                        })
                        .catch(()=>[])
                ])
                .then(([clientsData, setupTimingData]) => {
                    setClients(clientsData);
                    setSetupData(setupTimingData);
                    setLoading(false);
                });
            }, []);

            // Find matching setup info for selected client
            const getSetupInfo = (client) => {
                if(!client) return null;
                // Try to match by client name (fuzzy match)
                const clientName = client.client.toLowerCase();
                return setupData.find(s => {
                    const setupName = s.client.toLowerCase();
                    // Check if names match or contain each other
                    return setupName === clientName || 
                           setupName.includes(clientName) || 
                           clientName.includes(setupName) ||
                           // Match first/last name
                           clientName.split(' ').some(part => setupName.includes(part) && part.length > 2);
                });
            };

            const selectedSetupInfo = getSetupInfo(selected);

            const renderTab = () => {
                switch(tab) {
                    case 'overview': return <OverviewTab c={selected} setupInfo={selectedSetupInfo}/>;
                    case 'info': return <ClientInfoTab c={selected} setupInfo={selectedSetupInfo}/>;
                    case 'performance': return <PerformanceTab c={selected}/>;
                    case 'strategy': return <StrategyTab c={selected}/>;
                    default: return <OverviewTab c={selected} setupInfo={selectedSetupInfo}/>;
                }
            };

            if(loading) return <div className="min-h-screen flex items-center justify-center text-4xl">‚è≥</div>;

            return (
                <div className="flex min-h-screen">
                    <aside className="w-64 bg-dark-800 border-r border-dark-600 flex flex-col">
                        <div className="p-5 border-b border-dark-600">
                            <h1 className="text-xl font-bold gradient-text">VAM Client Hub</h1>
                            <p className="text-xs text-gray-500 mt-1">Success Manager</p>
                        </div>
                        <div className="p-4">
                            <select value={selected?.client||''} onChange={e=>setSelected(clients.find(c=>c.client===e.target.value))} className="w-full bg-dark-700 border border-dark-500 rounded-lg px-4 py-3 text-white appearance-none cursor-pointer hover:border-accent-cyan/50 focus:outline-none focus:border-accent-cyan">
                                <option value="">Select a client...</option>
                                {clients.map(c=><option key={c.client} value={c.client}>{c.client}</option>)}
                            </select>
                        </div>
                        <nav className="flex-1 py-2">
                            {tabs.map(t=>(
                                <button key={t.id} onClick={()=>setTab(t.id)} className={`w-full flex items-center gap-3 px-5 py-3 text-left transition-all ${tab===t.id?'tab-active text-white':'text-gray-400 hover:text-white hover:bg-dark-700'}`}>
                                    <span>{t.icon}</span>
                                    <span className="text-sm font-medium">{t.name}</span>
                                </button>
                            ))}
                        </nav>
                        <div className="p-4 border-t border-dark-600">
                            <a href="dashboard.html" className="block w-full text-center py-2 bg-dark-700 hover:bg-dark-600 text-gray-400 hover:text-white rounded-lg text-sm">‚Üí CEO Dashboard</a>
                        </div>
                    </aside>

                    <main className="flex-1 flex flex-col">
                        <header className="bg-dark-800/50 backdrop-blur border-b border-dark-600 px-8 py-4 flex justify-between items-center">
                            <div>
                                {selected ? (
                                    <div className="flex items-center gap-4">
                                        <h2 className="text-xl font-bold text-white">{selected.client}</h2>
                                        <Badge health={getHealth(selected.cpl)}/>
                                        <span className="text-gray-500">Day {selected.days}</span>
                                        {selectedSetupInfo?.csmRep && <span className="text-accent-purple text-sm">CSM: {selectedSetupInfo.csmRep}</span>}
                                    </div>
                                ) : <h2 className="text-xl text-gray-500">Select a client</h2>}
                            </div>
                            <button onClick={()=>setAiOpen(true)} className="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-accent-cyan to-accent-purple text-dark-900 font-semibold rounded-lg">ü§ñ Ask AI</button>
                        </header>
                        <div className="flex-1 overflow-y-auto p-8 scrollbar">{renderTab()}</div>
                    </main>

                    <AIChat open={aiOpen} onClose={()=>setAiOpen(false)} client={selected} setupInfo={selectedSetupInfo}/>
                    {!aiOpen && <button onClick={()=>setAiOpen(true)} className="fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-r from-accent-cyan to-accent-purple rounded-full flex items-center justify-center text-2xl shadow-lg hover:scale-110 transition-transform z-40">ü§ñ</button>}
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
    </script>
</body>
</html>
